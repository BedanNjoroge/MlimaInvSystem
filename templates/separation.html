{% extends "base.html" %}

{% block title %}Separation{% endblock %}

{% block content %}
    <h1>Separation</h1>
    <form method="post">
        <label for="boulder_id">Boulder ID:</label><br>
        <select id="boulder_id" name="boulder_id" required onchange="autoFillDescription();">
            <option value="">Select Boulder</option>
            {% for boulder_id in boulder_ids %}
                <option value="{{ boulder_id }}">{{ boulder_id }}</option>
            {% endfor %}
        </select><br>

        <label for="description">Description:</label><br>
        <input type="text" id="description" name="description" required><br>

        <label for="separation_time">Separation Time (Auto Generated):</label><br>
        <input type="text" id="separation_time" name="separation_time" readonly><br>

        <label for="good_slabs">Good Slabs:</label><br>
        <input type="number" id="good_slabs" name="good_slabs" required><br>

        <label for="defect_line">Defect Line:</label><br>
        <input type="number" id="defect_line" name="defect_line" required><br>

        <label for="natural_cracks">Natural Cracks:</label><br>
        <input type="number" id="natural_cracks" name="natural_cracks" required><br>

        <label for="cutting_cracks">Cutting Cracks:</label><br>
        <input type="number" id="cutting_cracks" name="cutting_cracks" required><br>

        <label for="thickness_issue">Thickness Issue:</label><br>
        <input type="number" id="thickness_issue" name="thickness_issue" required><br>

        <input type="submit" value="Submit">
    </form>

    <h2>Previous Separations</h2>
    <table>
        <tr>
            <th>Boulder ID</th>
            <th>Description</th>
            <th>Good Slabs</th>
            <th>Defect Line</th>
            <th>Natural Cracks</th>
            <th>Cutting Cracks</th>
            <th>Thickness Issue</th>
            <th>Separation Time</th>
        </tr>
        {% for separation in separations %}
        <tr>
            <td>{{ separation[1] }}</td>
            <td>{{ separation[2] }}</td>
            <td>{{ separation[3] }}</td>
            <td>{{ separation[4] }}</td>
            <td>{{ separation[5] }}</td>
            <td>{{ separation[6] }}</td>
            <td>{{ separation[7] }}</td>
            <td>{{ separation[8] }}</td>
        </tr>
        {% endfor %}
    </table>

    <script>
        console.log('Boulder descriptions:', {{ boulder_dict | tojson | safe }});

        const boulderDescriptions = {{ boulder_dict | tojson | safe }};
        
        function autoFillDescription() {
            const boulderId = document.getElementById('boulder_id').value;
            const description = boulderDescriptions[boulderId] || '';
            document.getElementById('description').value = description;
        }

        function setSeparationTime() {
            const now = new Date();
            const tzOffset = 180; // East Africa Time is UTC+3 hours
            const localTime = new Date(now.getTime() + tzOffset * 60000);
            const isoString = localTime.toISOString().slice(0, 19); // Remove milliseconds
            document.getElementById('separation_time').value = isoString;
        }

        // Set separation time when the page loads
        window.onload = setSeparationTime;
    </script>
{% endblock %}
